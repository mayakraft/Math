!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).math=n()}(this,(function(){"use strict";const t=function(t){switch(t.constructor.name){case"vector":case"matrix":case"segment":case"ray":case"line":case"circle":case"ellipse":case"rect":case"polygon":return t.constructor.name}if("object"==typeof t){if(null!=t.radius)return"circle";if(null!=t.width)return"rect";if(null!=t.x||"number"==typeof t[0])return"vector";if(null!=t[0]&&t[0].length&&("number"==typeof t[0].x||"number"==typeof t[0][0]))return"segment";if(null!=t.vector&&null!=t.origin)return"line"}},n=(t,n)=>n.length===t?n:Array(t).fill(0).map(((t,e)=>n[e]?n[e]:t)),e=(t,e)=>{const r=t.length>e.length?t.length:e.length;return[t,e].map((t=>n(r,t)))},r=function(t){const n=`${t}`.match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return n?Math.max(0,(n[1]?n[1].length:0)-(n[2]?+n[2]:0)):0},i=function(t,n=15){if("number"!=typeof t)return t;const e=parseFloat(t.toFixed(n));return r(e)===Math.min(n,r(t))?t:e},o=t=>null!=t&&"function"==typeof t[Symbol.iterator],s=function(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return o(arguments[0])&&"string"!=typeof arguments[0]?s(...arguments[0]):[arguments[0]];default:return Array.from(arguments).map((t=>o(t)?[...s(t)]:t))}},c=function(){switch(arguments.length){case void 0:case 0:return Array.from(arguments);case 1:return o(arguments[0])&&"string"!=typeof arguments[0]?c(...arguments[0]):[arguments[0]];default:return Array.from(arguments).map((t=>o(t)?[...c(t)]:t)).reduce(((t,n)=>t.concat(n)),[])}};var a=Object.freeze({__proto__:null,resize:n,resizeUp:e,resizeDown:(t,e)=>{const r=t.length>e.length?e.length:t.length;return[t,e].map((t=>n(r,t)))},cleanNumber:i,semiFlattenArrays:s,flattenArrays:c}),u=Object.create(null);const h=1e-6,l=180/Math.PI,f=Math.PI/180,p=2*Math.PI;var m=Object.freeze({__proto__:null,EPSILON:h,R2D:l,D2R:f,TWO_PI:p});const g=()=>!0,d=t=>t*t,y=(t,n)=>t+(n||0),v=t=>void 0!==t,M=t=>Math.atan2(t[1],t[0]),x=t=>[Math.cos(t),Math.sin(t)],b=(t,n,e=h)=>Math.abs(t-n)<e,_=(t,n,e=h)=>b(t,n,e)?0:Math.sign(n-t),P=(t,n,e=h)=>{for(let r=0;r<Math.max(t.length,n.length);r+=1)if(!b(t[r]||0,n[r]||0,e))return!1;return!0},O=(t,n=h)=>t>-n,j=(t,n=h)=>t>n,A=g,k=g,w=O,$=j,S=(t,n=h)=>t>-n&&t<1+n,N=(t,n=h)=>t>n&&t<1-n,z=t=>t<-h?0:t,I=t=>t<-h?0:t>1.000001?1:t;var L=Object.freeze({__proto__:null,fnTrue:g,fnSquare:d,fnAdd:y,fnNotUndefined:v,fnAnd:(t,n)=>t&&n,fnCat:(t,n)=>t.concat(n),fnVec2Angle:M,fnToVec2:x,fnEqual:(t,n)=>t===n,fnEpsilonEqual:b,fnEpsilonSort:_,fnEpsilonEqualVectors:P,include:O,exclude:j,includeL:A,excludeL:k,includeR:w,excludeR:$,includeS:S,excludeS:N,lineLimiter:t=>t,rayLimiter:z,segmentLimiter:I});const C=t=>Math.sqrt(t.map(d).reduce(y,0)),R=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),E=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),q=t=>t.map(d).reduce(y,0),T=t=>{const n=C(t);return 0===n?t:t.map((t=>t/n))},G=t=>{const n=R(t);return 0===n?t:[t[0]/n,t[1]/n]},B=t=>{const n=E(t);return 0===n?t:[t[0]/n,t[1]/n,t[2]/n]},F=(t,n)=>t.map((t=>t*n)),V=(t,n)=>[t[0]*n,t[1]*n],D=(t,n)=>t.map(((t,e)=>t+(n[e]||0))),Z=(t,n)=>[t[0]+n[0],t[1]+n[1]],H=(t,n)=>t.map(((t,e)=>t-(n[e]||0))),U=(t,n)=>[t[0]-n[0],t[1]-n[1]],X=(t,n)=>[t[0]-n[0],t[1]-n[1],t[2]-n[2]],Y=(t,n)=>t.map(((e,r)=>t[r]*n[r])).reduce(y,0),W=(t,n)=>t[0]*n[0]+t[1]*n[1],J=(t,n)=>t.map(((t,e)=>(t+n[e])/2)),K=function(){if(0===arguments.length)return[];const t=arguments[0].length>0?arguments[0].length:0,n=Array(t).fill(0);return Array.from(arguments).forEach((t=>n.forEach(((e,r)=>{n[r]+=t[r]||0})))),n.map((t=>t/arguments.length))},Q=(t,n,e)=>{const r=1-e;return t.map(((t,i)=>t*r+(n[i]||0)*e))},tt=(t,n)=>t[0]*n[1]-t[1]*n[0],nt=(t,n)=>[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]],et=(t,n)=>Math.sqrt(t.map(((e,r)=>(t[r]-n[r])**2)).reduce(y,0)),rt=(t,n)=>{const e=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(e*e+r*r)},it=t=>t.map((t=>-t)),ot=t=>[-t[1],t[0]],st=t=>[t[1],-t[0]],ct=(t,n=h)=>t.map((t=>Math.abs(t))).reduce(y,0)<n,at=(t,n,e=h)=>1-Math.abs(Y(T(t),T(n)))<e;var ut=Object.freeze({__proto__:null,magnitude:C,magnitude2:R,magnitude3:E,magSquared:q,normalize:T,normalize2:G,normalize3:B,scale:F,scale2:V,add:D,add2:Z,add3:(t,n)=>[t[0]+n[0],t[1]+n[1],t[2]+n[2]],subtract:H,subtract2:U,subtract3:X,dot:Y,dot2:W,midpoint:J,midpoint2:(t,n)=>V(Z(t,n),.5),average:K,lerp:Q,cross2:tt,cross3:nt,distance:et,distance2:rt,distance3:(t,n)=>{const e=t[0]-n[0],r=t[1]-n[1],i=t[2]-n[2];return Math.sqrt(e*e+r*r+i*i)},flip:it,rotate90:ot,rotate270:st,degenerate:ct,parallel:at,parallel2:(t,n,e=h)=>Math.abs(tt(t,n))<e});const ht=Object.freeze([1,0,0,0,1,0,0,0,1]),lt=Object.freeze(ht.concat(0,0,0)),ft=t=>lt.map(((n,e)=>Math.abs(n-t[e])<h)).reduce(((t,n)=>t&&n),!0),pt=(t,n)=>[t[0]*n[0]+t[3]*n[1]+t[6]*n[2]+t[9],t[1]*n[0]+t[4]*n[1]+t[7]*n[2]+t[10],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]+t[11]],mt=(t,n,e)=>({vector:[t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]],origin:[t[0]*e[0]+t[3]*e[1]+t[6]*e[2]+t[9],t[1]*e[0]+t[4]*e[1]+t[7]*e[2]+t[10],t[2]*e[0]+t[5]*e[1]+t[8]*e[2]+t[11]]}),gt=(t,n)=>[t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2],t[0]*n[3]+t[3]*n[4]+t[6]*n[5],t[1]*n[3]+t[4]*n[4]+t[7]*n[5],t[2]*n[3]+t[5]*n[4]+t[8]*n[5],t[0]*n[6]+t[3]*n[7]+t[6]*n[8],t[1]*n[6]+t[4]*n[7]+t[7]*n[8],t[2]*n[6]+t[5]*n[7]+t[8]*n[8],t[0]*n[9]+t[3]*n[10]+t[6]*n[11]+t[9],t[1]*n[9]+t[4]*n[10]+t[7]*n[11]+t[10],t[2]*n[9]+t[5]*n[10]+t[8]*n[11]+t[11]],dt=t=>t[0]*t[4]*t[8]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[6]*t[4]*t[2],yt=t=>{const n=dt(t);if(Math.abs(n)<1e-6||Number.isNaN(n)||!Number.isFinite(t[9])||!Number.isFinite(t[10])||!Number.isFinite(t[11]))return;const e=[t[4]*t[8]-t[7]*t[5],-t[1]*t[8]+t[7]*t[2],t[1]*t[5]-t[4]*t[2],-t[3]*t[8]+t[6]*t[5],t[0]*t[8]-t[6]*t[2],-t[0]*t[5]+t[3]*t[2],t[3]*t[7]-t[6]*t[4],-t[0]*t[7]+t[6]*t[1],t[0]*t[4]-t[3]*t[1],-t[3]*t[7]*t[11]+t[3]*t[8]*t[10]+t[6]*t[4]*t[11]-t[6]*t[5]*t[10]-t[9]*t[4]*t[8]+t[9]*t[5]*t[7],t[0]*t[7]*t[11]-t[0]*t[8]*t[10]-t[6]*t[1]*t[11]+t[6]*t[2]*t[10]+t[9]*t[1]*t[8]-t[9]*t[2]*t[7],-t[0]*t[4]*t[11]+t[0]*t[5]*t[10]+t[3]*t[1]*t[11]-t[3]*t[2]*t[10]-t[9]*t[1]*t[5]+t[9]*t[2]*t[4]],r=1/n;return e.map((t=>t*r))},vt=(t=0,n=0,e=0)=>ht.concat(t,n,e),Mt=(t,n,e,r,i)=>{const o=ht.concat([0,1,2].map((t=>n[t]||0))),s=Math.cos(t),c=Math.sin(t);return o[3*e+e]=s,o[3*e+r]=(i?1:-1)*c,o[3*r+e]=(i?-1:1)*c,o[3*r+r]=s,o},xt=(t,n=[0,0,0])=>Mt(t,n,1,2,!0),bt=(t,n=[0,0,0])=>Mt(t,n,0,2,!1),_t=(t,n=[0,0,0])=>Mt(t,n,0,1,!0),Pt=(t,e=[0,0,1],r=[0,0,0])=>{const i=[0,1,2].map((t=>r[t]||0)),[o,s,c]=n(3,T(e)),a=Math.cos(t),u=Math.sin(t),h=1-a,l=ht.concat(-i[0],-i[1],-i[2]),f=ht.concat(i[0],i[1],i[2]);return gt(f,gt([h*o*o+a,h*s*o+c*u,h*c*o-s*u,h*o*s-c*u,h*s*s+a,h*c*s+o*u,h*o*c+s*u,h*s*c-o*u,h*c*c+a,0,0,0],l))},Ot=(t=[1,1,1],n=[0,0,0])=>[t[0],0,0,0,t[1],0,0,0,t[2],t[0]*-n[0]+n[0],t[1]*-n[1]+n[1],t[2]*-n[2]+n[2]],jt=(t,n=[0,0])=>{const e=Math.atan2(t[1],t[0]),r=Math.cos(e),i=Math.sin(e),o=Math.cos(-e),s=Math.sin(-e),c=r*o+i*s,a=r*-s+i*o,u=i*o+-r*s,h=i*-s+-r*o;return[c,a,0,u,h,0,0,0,1,n[0]+c*-n[0]+-n[1]*u,n[1]+a*-n[0]+-n[1]*h,0]};var At=Object.freeze({__proto__:null,identity3x3:ht,identity3x4:lt,isIdentity3x4:ft,multiplyMatrix3Vector3:pt,multiplyMatrix3Line3:mt,multiplyMatrices3:gt,determinant3:dt,invertMatrix3:yt,makeMatrix3Translate:vt,makeMatrix3RotateX:xt,makeMatrix3RotateY:bt,makeMatrix3RotateZ:_t,makeMatrix3Rotate:Pt,makeMatrix3Scale:Ot,makeMatrix3ReflectZ:jt});const kt=(t,n)=>({vector:t||[],origin:n||[]}),wt=function(){if(arguments[0]instanceof u.vector)return arguments[0];let t=c(arguments);return t.length>0&&"object"==typeof t[0]&&null!==t[0]&&!Number.isNaN(t[0].x)&&(t=["x","y","z"].map((n=>t[0][n])).filter(v)),t.filter((t=>"number"==typeof t))},$t=function(){return s(arguments).map((t=>wt(t)))},St=function(){if(arguments[0]instanceof u.segment)return arguments[0];const t=s(arguments);return 4===t.length?[[t[0],t[1]],[t[2],t[3]]]:t.map((t=>wt(t)))},Nt=function(){const t=s(arguments);return 0===t.length?kt([],[]):t[0]instanceof u.line||t[0]instanceof u.ray||t[0]instanceof u.segment?t[0]:t[0].constructor===Object&&void 0!==t[0].vector?kt(t[0].vector||[],t[0].origin||[]):"number"==typeof t[0]?kt(wt(t)):kt(...t.map((t=>wt(t))))},zt=Nt,It=(t=0,n=0,e=0,r=0)=>({x:t,y:n,width:e,height:r}),Lt=function(){if(arguments[0]instanceof u.rect)return arguments[0];const t=c(arguments);if(t.length>0&&"object"==typeof t[0]&&null!==t[0]&&!Number.isNaN(t[0].width))return It(...["x","y","width","height"].map((n=>t[0][n])).filter(v));const n=t.filter((t=>"number"==typeof t)),e=n.length<4?[,,...n]:n;return It(...e)},Ct=(t=1,...n)=>({radius:t,origin:[...n]}),Rt=function(){if(arguments[0]instanceof u.circle)return arguments[0];const t=$t(arguments),n=c(arguments).filter((t=>"number"==typeof t));if(2===arguments.length){if(1===t[1].length)return Ct(t[1][0],...t[0]);if(1===t[0].length)return Ct(t[0][0],...t[1]);if(t[0].length>1&&t[1].length>1)return Ct(rt(...t),...t[0])}else switch(n.length){case 0:return Ct(1,0,0,0);case 1:return Ct(n[0],0,0,0);default:return Ct(n.pop(),...n)}return Ct(1,0,0,0)},Et=[[0,1,3,4,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,void 0,3,4,5,void 0,6,7,8,void 0,9,10,11]];[11,7,3].forEach((t=>delete Et[2][t]));const qt=t=>{let n;return n=t<8?0:t<13?1:2,Et[n]},Tt=function(){const t=c(arguments),n=[...lt];return qt(t.length).forEach(((e,r)=>{null!=t[r]&&(n[e]=t[r])})),n};var Gt=Object.freeze({__proto__:null,getVector:wt,getVectorOfVectors:$t,getSegment:St,getLine:Nt,getRay:zt,getRectParams:It,getRect:Lt,getCircle:Rt,getMatrix3x4:Tt});const Bt=({vector:t,origin:n})=>{const e=C(t),r=ot(t),i=Y(n,r)/e;return{normal:F(r,1/e),distance:i}},Ft=({normal:t,distance:n})=>({vector:st(t),origin:F(t,n)});var Vt=Object.freeze({__proto__:null,rayLineToUniqueLine:Bt,uniqueLineToRayLine:Ft});const Dt=(t,n,e)=>{const r=n.map(((n,r)=>({o:n,i:r,d:e(t,n)})));let i,o=1/0;for(let t=0;t<r.length;t+=1)r[t].d<o&&(i=t,o=r[t].d);return i},Zt=(t,n=h)=>{const e=((t,n=_,e=h)=>{let r=[0];for(let i=1;i<t.length;i+=1)switch(n(t[i][0],t[r[0]][0],e)){case 0:r.push(i);break;case 1:r=[i]}return r})(t,_,n);let r=0;for(let n=1;n<e.length;n+=1)t[e[n]][1]<t[e[r]][1]&&(r=n);return e[r]},Ht=(t,e,r,i,o=h)=>{e=n(t.length,e),r=n(t.length,r);const s=q(t),c=H(r,e),a=i(Y(t,c)/s,o);return D(e,F(t,a))},Ut=(t,n)=>{const e=t.map(((t,n,e)=>H(e[(n+1)%e.length],t)));return t.map(((t,r)=>Ht(e[r],t,n,I))).map(((t,e)=>({point:t,i:e,distance:et(t,n)}))).sort(((t,n)=>t.distance-n.distance)).shift()},Xt=(t,n,e)=>D(n,F(T(H(e,n)),t));var Yt=Object.freeze({__proto__:null,smallestComparisonSearch:Dt,minimum2DPointIndex:Zt,nearestPoint2:(t,n)=>{const e=Dt(t,n,rt);return void 0===e?void 0:n[e]},nearestPoint:(t,n)=>{const e=Dt(t,n,et);return void 0===e?void 0:n[e]},nearestPointOnLine:Ht,nearestPointOnPolygon:Ut,nearestPointOnCircle:Xt});const Wt=(t,n=h)=>{const e=[[0]];let r=0;for(let i=1;i<t.length;i+=1)b(t[i],t[i-1],n)?e[r].push(i):(r=e.length,e.push([i]));return e},Jt=(t=[],n=h)=>{const e=Zt(t,n),r=t.map((n=>U(n,t[e]))).map((t=>G(t))).map((t=>W([0,1],t))),i=r.map(((t,n)=>({a:t,i:n}))).sort(((t,n)=>t.a-n.a)).map((t=>t.i)).filter((t=>t!==e));return[[e]].concat(Wt(i.map((t=>r[t])),n).map((t=>t.map((t=>i[t])))).map((n=>1===n.length?n:n.map((n=>({i:n,len:rt(t[n],t[e])}))).sort(((t,n)=>t.len-n.len)).map((t=>t.i)))))};var Kt=Object.freeze({__proto__:null,sortPointsAlongVector2:(t,n)=>t.map((t=>({point:t,d:t[0]*n[0]+t[1]*n[1]}))).sort(((t,n)=>t.d-n.d)).map((t=>t.point)),clusterIndicesOfSortedNumbers:Wt,radialSortPointIndices:Jt});const Qt=[1,0,0,1],tn=Qt.concat(0,0),nn=t=>t[0]*t[3]-t[1]*t[2],en=(t,n=[0,0])=>{const e=Math.cos(t),r=Math.sin(t);return[e,r,-r,e,n[0],n[1]]};var rn=Object.freeze({__proto__:null,identity2x2:Qt,identity2x3:tn,multiplyMatrix2Vector2:(t,n)=>[t[0]*n[0]+t[2]*n[1]+t[4],t[1]*n[0]+t[3]*n[1]+t[5]],multiplyMatrix2Line2:(t,n,e)=>({vector:[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1]],origin:[t[0]*e[0]+t[2]*e[1]+t[4],t[1]*e[0]+t[3]*e[1]+t[5]]}),multiplyMatrices2:(t,n)=>[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1],t[0]*n[2]+t[2]*n[3],t[1]*n[2]+t[3]*n[3],t[0]*n[4]+t[2]*n[5]+t[4],t[1]*n[4]+t[3]*n[5]+t[5]],determinant2:nn,invertMatrix2:t=>{const n=nn(t);if(!(Math.abs(n)<1e-6||Number.isNaN(n))&&Number.isFinite(t[4])&&Number.isFinite(t[5]))return[t[3]/n,-t[1]/n,-t[2]/n,t[0]/n,(t[2]*t[5]-t[3]*t[4])/n,(t[1]*t[4]-t[0]*t[5])/n]},makeMatrix2Translate:(t=0,n=0)=>Qt.concat(t,n),makeMatrix2Scale:(t=[1,1],n=[0,0])=>[t[0],0,0,t[1],t[0]*-n[0]+n[0],t[1]*-n[1]+n[1]],makeMatrix2Rotate:en,makeMatrix2Reflect:(t,n=[0,0])=>{const e=Math.atan2(t[1],t[0]),r=Math.cos(e),i=Math.sin(e),o=Math.cos(-e),s=Math.sin(-e),c=r*o+i*s,a=r*-s+i*o,u=i*o+-r*s,h=i*-s+-r*o;return[c,a,u,h,n[0]+c*-n[0]+-n[1]*u,n[1]+a*-n[0]+-n[1]*h]}});const on=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),sn=(t,n)=>[t[0]*n[0]+t[4]*n[1]+t[8]*n[2]+t[12]*n[3],t[1]*n[0]+t[5]*n[1]+t[9]*n[2]+t[13]*n[3],t[2]*n[0]+t[6]*n[1]+t[10]*n[2]+t[14]*n[3],t[3]*n[0]+t[7]*n[1]+t[11]*n[2]+t[15]*n[3],t[0]*n[4]+t[4]*n[5]+t[8]*n[6]+t[12]*n[7],t[1]*n[4]+t[5]*n[5]+t[9]*n[6]+t[13]*n[7],t[2]*n[4]+t[6]*n[5]+t[10]*n[6]+t[14]*n[7],t[3]*n[4]+t[7]*n[5]+t[11]*n[6]+t[15]*n[7],t[0]*n[8]+t[4]*n[9]+t[8]*n[10]+t[12]*n[11],t[1]*n[8]+t[5]*n[9]+t[9]*n[10]+t[13]*n[11],t[2]*n[8]+t[6]*n[9]+t[10]*n[10]+t[14]*n[11],t[3]*n[8]+t[7]*n[9]+t[11]*n[10]+t[15]*n[11],t[0]*n[12]+t[4]*n[13]+t[8]*n[14]+t[12]*n[15],t[1]*n[12]+t[5]*n[13]+t[9]*n[14]+t[13]*n[15],t[2]*n[12]+t[6]*n[13]+t[10]*n[14]+t[14]*n[15],t[3]*n[12]+t[7]*n[13]+t[11]*n[14]+t[15]*n[15]],cn=t=>{const n=t[10]*t[15]-t[11]*t[14],e=t[9]*t[15]-t[11]*t[13],r=t[9]*t[14]-t[10]*t[13],i=t[8]*t[15]-t[11]*t[12],o=t[8]*t[14]-t[10]*t[12],s=t[8]*t[13]-t[9]*t[12];return t[0]*(t[5]*n-t[6]*e+t[7]*r)-t[1]*(t[4]*n-t[6]*i+t[7]*o)+t[2]*(t[4]*e-t[5]*i+t[7]*s)-t[3]*(t[4]*r-t[5]*o+t[6]*s)},an=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0]),un=(t=0,n=0,e=0)=>[...an,t,n,e,1],hn=(t,n,e,r,i)=>{const o=un(...n),s=Math.cos(t),c=Math.sin(t);return o[4*e+e]=s,o[4*e+r]=(i?1:-1)*c,o[4*r+e]=(i?-1:1)*c,o[4*r+r]=s,o};var ln=Object.freeze({__proto__:null,identity4x4:on,isIdentity4x4:t=>on.map(((n,e)=>Math.abs(n-t[e])<h)).reduce(((t,n)=>t&&n),!0),multiplyMatrix4Vector3:(t,n)=>[t[0]*n[0]+t[4]*n[1]+t[8]*n[2]+t[12],t[1]*n[0]+t[5]*n[1]+t[9]*n[2]+t[13],t[2]*n[0]+t[6]*n[1]+t[10]*n[2]+t[14]],multiplyMatrix4Line3:(t,n,e)=>({vector:[t[0]*n[0]+t[4]*n[1]+t[8]*n[2],t[1]*n[0]+t[5]*n[1]+t[9]*n[2],t[2]*n[0]+t[6]*n[1]+t[10]*n[2]],origin:[t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]]}),multiplyMatrices4:sn,determinant4:cn,invertMatrix4:t=>{const n=cn(t);if(Math.abs(n)<1e-6||Number.isNaN(n)||!Number.isFinite(t[12])||!Number.isFinite(t[13])||!Number.isFinite(t[14]))return;const e=t[10]*t[15]-t[11]*t[14],r=t[9]*t[15]-t[11]*t[13],i=t[9]*t[14]-t[10]*t[13],o=t[8]*t[15]-t[11]*t[12],s=t[8]*t[14]-t[10]*t[12],c=t[8]*t[13]-t[9]*t[12],a=t[6]*t[15]-t[7]*t[14],u=t[5]*t[15]-t[7]*t[13],h=t[5]*t[14]-t[6]*t[13],l=t[6]*t[11]-t[7]*t[10],f=t[5]*t[11]-t[7]*t[9],p=t[5]*t[10]-t[6]*t[9],m=t[4]*t[15]-t[7]*t[12],g=t[4]*t[14]-t[6]*t[12],d=t[4]*t[11]-t[7]*t[8],y=t[4]*t[10]-t[6]*t[8],v=t[4]*t[13]-t[5]*t[12],M=t[4]*t[9]-t[5]*t[8],x=[+(t[5]*e-t[6]*r+t[7]*i),-(t[1]*e-t[2]*r+t[3]*i),+(t[1]*a-t[2]*u+t[3]*h),-(t[1]*l-t[2]*f+t[3]*p),-(t[4]*e-t[6]*o+t[7]*s),+(t[0]*e-t[2]*o+t[3]*s),-(t[0]*a-t[2]*m+t[3]*g),+(t[0]*l-t[2]*d+t[3]*y),+(t[4]*r-t[5]*o+t[7]*c),-(t[0]*r-t[1]*o+t[3]*c),+(t[0]*u-t[1]*m+t[3]*v),-(t[0]*f-t[1]*d+t[3]*M),-(t[4]*i-t[5]*s+t[6]*c),+(t[0]*i-t[1]*s+t[2]*c),-(t[0]*h-t[1]*g+t[2]*v),+(t[0]*p-t[1]*y+t[2]*M)],b=1/n;return x.map((t=>t*b))},makeMatrix4Translate:un,makeMatrix4RotateX:(t,n=[0,0,0])=>hn(t,n,1,2,!0),makeMatrix4RotateY:(t,n=[0,0,0])=>hn(t,n,0,2,!1),makeMatrix4RotateZ:(t,n=[0,0,0])=>hn(t,n,0,1,!0),makeMatrix4Rotate:(t,e=[0,0,1],r=[0,0,0])=>{const i=[0,1,2].map((t=>r[t]||0)),[o,s,c]=n(3,T(e)),a=Math.cos(t),u=Math.sin(t),h=1-a,l=un(-i[0],-i[1],-i[2]),f=un(i[0],i[1],i[2]);return sn(f,sn([h*o*o+a,h*s*o+c*u,h*c*o-s*u,0,h*o*s-c*u,h*s*s+a,h*c*s+o*u,0,h*o*c+s*u,h*s*c-o*u,h*c*c+a,0,0,0,0,1],l))},makeMatrix4Scale:(t=[1,1,1],n=[0,0,0])=>[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,t[0]*-n[0]+n[0],t[1]*-n[1]+n[1],t[2]*-n[2]+n[2],1],makeMatrix4ReflectZ:(t,n=[0,0])=>{const e=Math.atan2(t[1],t[0]),r=Math.cos(e),i=Math.sin(e),o=Math.cos(-e),s=Math.sin(-e),c=r*o+i*s,a=r*-s+i*o,u=i*o+-r*s,h=i*-s+-r*o;return[c,a,0,0,u,h,0,0,0,0,1,0,n[0]+c*-n[0]+-n[1]*u,n[1]+a*-n[0]+-n[1]*h,0,1]},makePerspectiveMatrix4:(t,n,e,r)=>{const i=Math.tan(.5*Math.PI-.5*t),o=1/(e-r);return[i/n,0,0,0,0,i,0,0,0,0,(e+r)*o,-1,0,0,e*r*o*2,0]},makeOrthographicMatrix4:(t,n,e,r,i,o)=>[2/(n-r),0,0,0,0,2/(t-e),0,0,0,0,2/(i-o),0,(r+n)/(r-n),(e+t)/(e-t),(i+o)/(i-o),1],makeLookAtMatrix4:(t,n,e)=>{const r=B(X(t,n)),i=B(nt(e,r)),o=B(nt(r,i));return[i[0],i[1],i[2],0,o[0],o[1],o[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],1]}});const fn=(t,n,e=j,r=h)=>t.map(((t,n,e)=>[t,e[(n+1)%e.length]])).map((t=>tt(T(H(t[1],t[0])),H(n,t[0])))).map((t=>e(t,r))).map(((t,n,e)=>t===e[0])).reduce(((t,n)=>t&&n),!0),pn=(t,n,e)=>D(n,F(t,e)),mn=(t,n,e,r,i)=>t.map(((t,n,e)=>[H(e[(n+1)%e.length],t),t])).map((t=>((t,n,e,r,i=S,o=h)=>{const s=tt(T(t),T(e));if(Math.abs(s)<o)return;const c=tt(t,e),a=-c,u=H(r,n),l=it(u),f=tt(u,e)/c;return i(tt(l,t)/a,o/C(e))?f:void 0})(n,e,t[0],t[1],r,i))).filter(v).sort(((t,n)=>t-n)),gn=(t,n,e,r=O,i=A,o=h)=>{const s=mn(t,n,e,S,o);if(s.length<2)return;const c=((t,n,e)=>{let r=0,i=t.length-1;for(;r<i&&!n(t[r+1]-t[r],e);)r+=1;for(;i>r&&!n(t[i]-t[i-1],e);)i-=1;if(!(r>=i))return[t[r],t[i]]})(s,r,2*o/C(n));if(void 0===c)return;const a=c.map((t=>i(t)?t:t<.5?0:1));if(Math.abs(a[0]-a[1])<2*o/C(n))return;const u=pn(n,e,(a[0]+a[1])/2);return fn(t,u,r,o)?a.map((t=>pn(n,e,t))):void 0},dn=(t,n)=>{for(;t<0;)t+=p;for(;n<0;)n+=p;for(;t>p;)t-=p;for(;n>p;)n-=p;const e=t-n;return e>=0?e:p-(n-t)},yn=(t,n)=>{for(;t<0;)t+=p;for(;n<0;)n+=p;for(;t>p;)t-=p;for(;n>p;)n-=p;const e=n-t;return e>=0?e:p-(t-n)},vn=(t,n)=>{const e=n[0]*t[0]+n[1]*t[1],r=n[0]*t[1]-n[1]*t[0];let i=Math.atan2(r,e);return i<0&&(i+=p),i},Mn=(t,n)=>{const e=t[0]*n[0]+t[1]*n[1],r=t[0]*n[1]-t[1]*n[0];let i=Math.atan2(r,e);return i<0&&(i+=p),i},xn=(t,n)=>x(M(t)-vn(t,n)/2),bn=(t,n)=>x(M(t)+Mn(t,n)/2),_n=(t,n,e)=>{const r=dn(n,e)/t;return Array.from(Array(t-1)).map(((t,e)=>n+r*(e+1)))},Pn=(t,n,e)=>{const r=yn(n,e)/t;return Array.from(Array(t-1)).map(((t,e)=>n+r*(e+1)))},On=(t,n,e)=>{const r=Math.atan2(n[1],n[0]),i=Math.atan2(e[1],e[0]);return _n(t,r,i).map(x)},jn=(t,n,e)=>{const r=Math.atan2(n[1],n[0]),i=Math.atan2(e[1],e[0]);return Pn(t,r,i).map(x)},An=(t,n,e,r,i=h)=>{const o=tt(t,e),s=Y(t,e),c=o>-i?[bn(t,e)]:[xn(t,e)];c[1]=o>-i?ot(c[0]):st(c[0]);const a=((r[0]-n[0])*e[1]-e[0]*(r[1]-n[1]))/o,u=[t,e].map((t=>T(t))),l=Math.abs(tt(...u))<i,f=l?J(n,r):[n[0]+t[0]*a,n[1]+t[1]*a],p=c.map((t=>({vector:t,origin:f})));return l&&delete p[s>-i?1:0],p},kn=function(){const t=Array.from(arguments).flat(),n=t.map(((t,n)=>n)).sort(((n,e)=>t[n]-t[e]));return n.slice(n.indexOf(0),n.length).concat(n.slice(0,n.indexOf(0)))},wn=function(){const t=Array.from(arguments).flat(),n=kn(t).map((n=>t[n]));return n.map(((t,n,e)=>[t,e[(n+1)%e.length]])).map((t=>yn(t[0],t[1])))},$n=(t,n,e,r=h)=>{const i=G(U(n,t)),o=G(U(e,t)),s=tt(i,o);return b(s,0,r)?b(rt(t,n)+rt(n,e),rt(t,e))?0:void 0:Math.sign(s)};var Sn=Object.freeze({__proto__:null,isCounterClockwiseBetween:(t,n,e)=>{for(;e<n;)e+=p;for(;t>n;)t-=p;for(;t<n;)t+=p;return t<e},clockwiseAngleRadians:dn,counterClockwiseAngleRadians:yn,clockwiseAngle2:vn,counterClockwiseAngle2:Mn,clockwiseBisect2:xn,counterClockwiseBisect2:bn,clockwiseSubsectRadians:_n,counterClockwiseSubsectRadians:Pn,clockwiseSubsect2:On,counterClockwiseSubsect2:jn,bisectLines2:An,counterClockwiseOrderRadians:kn,counterClockwiseOrder2:function(){return kn(s(arguments).map(M))},counterClockwiseSectorsRadians:wn,counterClockwiseSectors2:function(){return wn($t(arguments).map(M))},threePointTurnDirection:$n});const Nn=(t=[],n=!1,e=h)=>{if(t.length<2)return[];const r=Jt(t,e).map((t=>1===t.length?t:(t=>t.concat(t.slice(0,-1).reverse()))(t))).flat();r.push(r[0]);const i=[r[0]];let o=1;const s={"-1":()=>i.pop(),1:t=>{i.push(t),o+=1},undefined:()=>{o+=1}};for(s[0]=n?s[1]:s[-1];o<r.length;){if(i.length<2){i.push(r[o]),o+=1;continue}const n=i[i.length-2],c=i[i.length-1],a=r[o];s[$n(...[n,c,a].map((n=>t[n])),e)](a)}return i.pop(),i},zn=(t=[],n=!1,e=h)=>Nn(t,n,e).map((n=>t[n]));var In=Object.freeze({__proto__:null,convexHullIndices:Nn,convexHull:zn});const Ln=(t,n,e,r,i=A,o=A,s=h)=>{const c=tt(T(t),T(e));if(Math.abs(c)<s)return;const a=tt(t,e),u=-a,l=[r[0]-n[0],r[1]-n[1]],f=[-l[0],-l[1]],p=tt(l,e)/a,m=tt(f,t)/u;return i(p,s/C(t))&&o(m,s/C(e))?D(n,F(t,p)):void 0};var Cn=Object.freeze({__proto__:null,pleat:(t,n,e)=>{const r=Nt(n),i=Nt(e);return at(r.vector,i.vector)?((t,n,e)=>{const r=Array.from(Array(t-1)).map(((n,e)=>(e+1)/t)).map((t=>Q(n.origin,e.origin,t))),i=[...n.vector];return r.map((t=>({origin:t,vector:i})))})(t,r,i):((t,n,e)=>{const r=Ln(n.vector,n.origin,e.vector,e.origin);return(vn(n.vector,e.vector)<Mn(n.vector,e.vector)?On(t,n.vector,e.vector):jn(t,n.vector,e.vector)).map((t=>({origin:r,vector:t})))})(t,r,i)}});const Rn=t=>Array.from(Array(Math.floor(t))).map(((n,e)=>p*(e/t))),En=(t,n)=>t.map((t=>[n*Math.cos(t),n*Math.sin(t)])).map((t=>t.map((t=>i(t,14))))),qn=(t=3,n=1)=>En(Rn(t),n),Tn=(t=3,n=1)=>{const e=Math.PI/t,r=Rn(t).map((t=>t+e));return En(r,n)},Gn=function(t,n,e){const r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],s=e[1]-t[1],c=r*(t[0]+n[0])+i*(t[1]+n[1]),a=o*(t[0]+e[0])+s*(t[1]+e[1]),u=2*(r*(e[1]-n[1])-i*(e[0]-n[0]));if(Math.abs(u)<h){const r=Math.min(t[0],n[0],e[0]),i=Math.min(t[1],n[1],e[1]),o=.5*(Math.max(t[0],n[0],e[0])-r),s=.5*(Math.max(t[1],n[1],e[1])-i);return{origin:[r+o,i+s],radius:Math.sqrt(o*o+s*s)}}const l=[(s*c-i*a)/u,(r*a-o*c)/u],f=l[0]-t[0],p=l[1]-t[1];return{origin:l,radius:Math.sqrt(f*f+p*p)}},Bn=t=>.5*t.map(((t,n,e)=>{const r=e[(n+1)%e.length];return t[0]*r[1]-r[0]*t[1]})).reduce(y,0),Fn=t=>{const n=1/(6*Bn(t));return t.map(((t,n,e)=>{const r=e[(n+1)%e.length],i=t[0]*r[1]-r[0]*t[1];return[(t[0]+r[0])*i,(t[1]+r[1])*i]})).reduce(((t,n)=>[t[0]+n[0],t[1]+n[1]]),[0,0]).map((t=>t*n))},Vn=(t,n=0)=>{const e=Array(t[0].length).fill(1/0),r=Array(t[0].length).fill(-1/0);t.forEach((t=>t.forEach(((t,i)=>{t<e[i]&&(e[i]=t-n),t>r[i]&&(r[i]=t+n)}))));const i=r.map(((t,n)=>t-e[n]));return{min:e,max:r,span:i}};var Dn=Object.freeze({__proto__:null,makePolygonCircumradius:qn,makePolygonCircumradiusSide:Tn,makePolygonInradius:(t=3,n=1)=>qn(t,n/Math.cos(Math.PI/t)),makePolygonInradiusSide:(t=3,n=1)=>Tn(t,n/Math.cos(Math.PI/t)),makePolygonSideLength:(t=3,n=1)=>qn(t,n/2/Math.sin(Math.PI/t)),makePolygonSideLengthSide:(t=3,n=1)=>Tn(t,n/2/Math.sin(Math.PI/t)),makePolygonNonCollinear:(t,n=h)=>{const e=t.map(((t,n,e)=>[t,e[(n+1)%e.length]])).map((t=>H(t[1],t[0]))).map(((t,n,e)=>[t,e[(n+e.length-1)%e.length]])).map((t=>!at(t[1],t[0],n)));return t.filter(((t,n)=>e[n]))},circumcircle:Gn,signedArea:Bn,centroid:Fn,boundingBox:Vn});const Zn=(t,n,e,r=k,i=h)=>{const o=H(e,n),s=q(t),c=Math.sqrt(s);if(c<i)return!1;const a=tt(o,t.map((t=>t/c))),u=Y(o,t)/s;return Math.abs(a)<i&&r(u,i/c)},Hn=(t,n,e)=>{const r=t.map(((t,r)=>({point:Zn(n,e,t,A)?t:null,at_index:r}))).filter((t=>null!=t.point)),i=t.map(((t,r,i)=>({point:Ln(n,e,H(t,i[(r+1)%i.length]),i[(r+1)%i.length],k,N),at_index:r}))).filter((t=>null!=t.point));if(2===i.length){const n=i.slice().sort(((t,n)=>t.at_index-n.at_index)),e=t.slice(n[1].at_index+1).concat(t.slice(0,n[0].at_index+1));e.push(n[0].point),e.push(n[1].point);const r=t.slice(n[0].at_index+1,n[1].at_index+1);return r.push(n[1].point),r.push(n[0].point),[e,r]}if(1===i.length&&1===r.length){r[0].type="v",i[0].type="e";const n=r.concat(i).sort(((t,n)=>t.at_index-n.at_index)),e=t.slice(n[1].at_index+1).concat(t.slice(0,n[0].at_index+1));"e"===n[0].type&&e.push(n[0].point),e.push(n[1].point);const o=t.slice(n[0].at_index+1,n[1].at_index+1);return"e"===n[1].type&&o.push(n[1].point),o.push(n[0].point),[e,o]}if(2===r.length){const n=r.slice().sort(((t,n)=>t.at_index-n.at_index));return[t.slice(n[1].at_index).concat(t.slice(0,n[0].at_index+1)),t.slice(n[0].at_index,n[1].at_index+1)]}return[t.slice()]},Un=(t,n,e)=>{const r=t.map(((t,n)=>({vector:e[n],origin:t}))).map(((t,n,e)=>Ln(t.vector,t.origin,e[(n+1)%e.length].vector,e[(n+1)%e.length].origin,$,$))),i=n.map(((t,n)=>Ht(t.vector,t.origin,r[n],(t=>t))));if(3===t.length)return t.map((t=>({type:"skeleton",points:[t,r[0]]}))).concat([{type:"perpendicular",points:[i[0],r[0]]}]);const o=r.map(((t,n)=>et(t,i[n])));let s=0;o.forEach(((t,n)=>{t<o[s]&&(s=n)}));const c=[{type:"skeleton",points:[t[s],r[s]]},{type:"skeleton",points:[t[(s+1)%t.length],r[s]]},{type:"perpendicular",points:[i[s],r[s]]}],a=xn(it(n[(s+n.length-1)%n.length].vector),n[(s+1)%n.length].vector),u=s===t.length-1;return t.splice(s,2,r[s]),n.splice(s,1),e.splice(s,2,a),u&&(t.splice(0,1),e.splice(0,1),n.push(n.shift())),c.concat(Un(t,n,e))},Xn=t=>{const n=t.map(((t,n,e)=>[t,e[(n+1)%e.length]])).map((t=>({vector:H(t[1],t[0]),origin:t[0]}))),e=t.map(((t,n,e)=>[(n-1+e.length)%e.length,n,(n+1)%e.length].map((t=>e[t])))).map((t=>[H(t[0],t[1]),H(t[2],t[1])])).map((t=>xn(...t)));return Un([...t],n,e)};var Yn=Object.freeze({__proto__:null,collinearBetween:(t,n,e,r=!1,i=h)=>{if([t,e].map((t=>P(n,t))).reduce(((t,n)=>t||n),!1))return r;const o=[[t,n],[n,e]].map((t=>H(t[1],t[0]))).map((t=>T(t)));return b(1,Y(...o),i)}});var Wn=Object.freeze({__proto__:null,enclosingBoundingBoxes:(t,n)=>{const e=Math.min(t.min.length,n.min.length);for(let r=0;r<e;r+=1)if(n.min[r]<t.min[r]||n.max[r]>t.max[r])return!1;return!0},enclosingPolygonPolygon:(t,n,e=O)=>{const r=t.map((t=>fn(n,t,e))).reduce(((t,n)=>t||n),!1),i=n.map((t=>fn(n,t,e))).reduce(((t,n)=>t&&n),!0);return!r&&i}});const Jn=(t,n,e)=>{const r=n[0]-t[0],i=n[1]-t[1],o=r*Math.cos(e)+i*Math.sin(e),s=i*Math.cos(e)-r*Math.sin(e);return[t[0]+o,t[1]+s]},Kn=(t,n,e,r,i=h)=>{const o=t<e?t:e,s=t<e?e:t,c=t<e?n:r,a=t<e?r:n,u=[c[0]-a[0],c[1]-a[1]],l=Math.sqrt(u[0]**2+u[1]**2);if(l<i)return;const f=u.map(((t,n)=>t/l*s+a[n]));if(Math.abs(s+o-l)<i||Math.abs(s-(o+l))<i)return[f];if(l+o<s||s+o<l)return;const p=(m=(o*o-l*l-s*s)/(-2*l*s))>=1?0:m<=-1?Math.PI:Math.acos(m);var m;return[Jn(a,f,+p),Jn(a,f,-p)]},Qn=(t,n,e,r,i=A,o=h)=>{const s=e[0]**2+e[1]**2,c=Math.sqrt(s),a=0===c?e:e.map((t=>t/c)),u=ot(a),l=H(r,n),f=tt(l,a);if(Math.abs(f)>t+o)return;const p=Math.sqrt(t**2-f**2),m=(t,e)=>n[e]-u[e]*f+a[e]*t,g=Math.abs(t-Math.abs(f))<o?[p].map((t=>[t,t].map(m))):[-p,p].map((t=>[t,t].map(m))),d=g.map((t=>t.map(((t,n)=>t-r[n])))).map((t=>t[0]*e[0]+e[1]*t[1])).map((t=>t/s));return g.filter(((t,n)=>i(d[n],o)))},te=t=>{for(let n=1;n<t.length;n+=1)if(!P(t[0],t[n]))return[t[0],t[n]]},ne=(t,n,e,r=S,i=A,o=h)=>{const s=t.map(((t,n,e)=>[t,e[(n+1)%e.length]])).map((t=>Ln(H(t[1],t[0]),t[0],n,e,r,i,o))).filter((t=>void 0!==t));switch(s.length){case 0:return;case 1:return[s];default:return te(s)||[s[0]]}},ee=(t,n,e,r=S,i=k,o=h)=>{const s=ne(t,n,e,r,i,o);let c;switch(i){case $:c=w;break;case N:c=S;break;default:return s}const a=ne(t,n,e,S,c,o);if(void 0===a)return;const u=te(a);if(void 0===u)switch(i){case $:return fn(t,e,j,o)?a:void 0;case N:return fn(t,D(e,n),j,o)||fn(t,e,j,o)?a:void 0;case k:default:return}return fn(t,J(...u),j,o)?u:s},re={polygon:t=>[t],rect:t=>[t],circle:t=>[t.radius,t.origin],line:t=>[t.vector,t.origin],ray:t=>[t.vector,t.origin],segment:t=>[t.vector,t.origin]},ie={polygon:{line:(t,n,e,r,i)=>ee(...t,...n,S,r,i),ray:(t,n,e,r,i)=>ee(...t,...n,S,r,i),segment:(t,n,e,r,i)=>ee(...t,...n,S,r,i)},circle:{circle:(t,n,e,r,i)=>Kn(...t,...n,i),line:(t,n,e,r,i)=>Qn(...t,...n,r,i),ray:(t,n,e,r,i)=>Qn(...t,...n,r,i),segment:(t,n,e,r,i)=>Qn(...t,...n,r,i)},line:{polygon:(t,n,e,r,i)=>ee(...n,...t,S,e,i),circle:(t,n,e,r,i)=>Qn(...n,...t,e,i),line:(t,n,e,r,i)=>Ln(...t,...n,e,r,i),ray:(t,n,e,r,i)=>Ln(...t,...n,e,r,i),segment:(t,n,e,r,i)=>Ln(...t,...n,e,r,i)},ray:{polygon:(t,n,e,r,i)=>ee(...n,...t,S,e,i),circle:(t,n,e,r,i)=>Qn(...n,...t,e,i),line:(t,n,e,r,i)=>Ln(...n,...t,r,e,i),ray:(t,n,e,r,i)=>Ln(...t,...n,e,r,i),segment:(t,n,e,r,i)=>Ln(...t,...n,e,r,i)},segment:{polygon:(t,n,e,r,i)=>ee(...n,...t,S,e,i),circle:(t,n,e,r,i)=>Qn(...n,...t,e,i),line:(t,n,e,r,i)=>Ln(...n,...t,r,e,i),ray:(t,n,e,r,i)=>Ln(...n,...t,r,e,i),segment:(t,n,e,r,i)=>Ln(...t,...n,e,r,i)}},oe={polygon:"polygon",rect:"polygon",circle:"circle",line:"line",ray:"ray",segment:"segment"},se={polygon:j,rect:j,circle:j,line:k,ray:$,segment:N},ce=function(n,e,r){const i=t(n),o=t(e),s=oe[i],c=oe[o],a=re[i](n),u=re[o](e),h=n.domain_function||se[i],l=e.domain_function||se[o];return ie[s][c](a,u,h,l,r)},ae=(t,n,e=h)=>{for(let r=0;r<2;r+=1){const i=0===r?t:n,o=0===r?n:t;for(let t=0;t<i.length;t+=1){const n=i[t],r=ot(H(i[(t+1)%i.length],i[t])),s=o.map((t=>H(t,n))).map((t=>Y(r,t))),c=i[(t+2)%i.length],a=Y(r,H(c,n))>0;if(s.map((t=>a?t<e:t>-e)).reduce(((t,n)=>t&&n),!0))return!1}}return!0},ue=(t,n,e,r=j,i=h)=>r(t-rt(n,e),i),he=(t,n,e,r,i=k,o=k,s=h)=>{const c=tt(t,e),a=-c,u=[r[0]-n[0],r[1]-n[1]];if(Math.abs(c)<s){if(Math.abs(tt(u,t))>s)return!1;const n=u,r=D(n,e),i=Y(t,t),o=Y(n,t)/i,c=Y(r,t)/i,a=(o<c?c:o)<s;return!((o<c?o:c)>1-s)&&!a}const l=[-u[0],-u[1]],f=tt(u,e)/c,p=tt(l,t)/a;return i(f,s/C(t))&&o(p,s/C(e))},le={polygon:t=>[t],rect:t=>[t],circle:t=>[t.radius,t.origin],line:t=>[t.vector,t.origin],ray:t=>[t.vector,t.origin],segment:t=>[t.vector,t.origin],vector:t=>[t]},fe={polygon:{polygon:(t,n,e,r,i)=>ae(...t,...n,i),vector:(t,n,e,r,i)=>fn(...t,...n,e,i)},circle:{vector:(t,n,e,r,i)=>ue(...t,...n,j,i)},line:{line:(t,n,e,r,i)=>he(...t,...n,e,r,i),ray:(t,n,e,r,i)=>he(...t,...n,e,r,i),segment:(t,n,e,r,i)=>he(...t,...n,e,r,i),vector:(t,n,e,r,i)=>Zn(...t,...n,e,i)},ray:{line:(t,n,e,r,i)=>he(...n,...t,r,e,i),ray:(t,n,e,r,i)=>he(...t,...n,e,r,i),segment:(t,n,e,r,i)=>he(...t,...n,e,r,i),vector:(t,n,e,r,i)=>Zn(...t,...n,e,i)},segment:{line:(t,n,e,r,i)=>he(...n,...t,r,e,i),ray:(t,n,e,r,i)=>he(...n,...t,r,e,i),segment:(t,n,e,r,i)=>he(...t,...n,e,r,i),vector:(t,n,e,r,i)=>Zn(...t,...n,e,i)},vector:{polygon:(t,n,e,r,i)=>fn(...n,...t,r,i),circle:(t,n,e,r,i)=>ue(...n,...t,j,i),line:(t,n,e,r,i)=>Zn(...n,...t,r,i),ray:(t,n,e,r,i)=>Zn(...n,...t,r,i),segment:(t,n,e,r,i)=>Zn(...n,...t,r,i),vector:(t,n,e,r,i)=>P(...t,...n,i)}},pe={polygon:"polygon",rect:"polygon",circle:"circle",line:"line",ray:"ray",segment:"segment",vector:"vector"},me={polygon:j,rect:j,circle:j,line:k,ray:$,segment:N,vector:k},ge=function(n,e,r){const i=t(n),o=t(e),s=pe[i],c=pe[o],a=le[i](n),u=le[o](e),h=n.domain_function||me[i],l=e.domain_function||me[o];return fe[s][c](a,u,h,l,r)},de={preserve:{magnitude:function(){return C(this)},isEquivalent:function(){return P(this,wt(arguments))},isParallel:function(){return at(...e(this,wt(arguments)))},isCollinear:function(t){return ge(this,t)},dot:function(){return Y(...e(this,wt(arguments)))},distanceTo:function(){return et(...e(this,wt(arguments)))},overlap:function(t){return ge(this,t)}},vector:{copy:function(){return[...this]},normalize:function(){return T(this)},scale:function(){return F(this,arguments[0])},flip:function(){return it(this)},rotate90:function(){return ot(this)},rotate270:function(){return st(this)},cross:function(){return nt(n(3,this),n(3,wt(arguments)))},transform:function(){return pt(Tt(arguments),n(3,this))},add:function(){return D(this,n(this.length,wt(arguments)))},subtract:function(){return H(this,n(this.length,wt(arguments)))},rotateZ:function(t,e){return pt(Tt(en(t,e)),n(3,this))},lerp:function(t,e){return Q(this,n(this.length,wt(t)),e)},midpoint:function(){return J(...e(this,wt(arguments)))},bisect:function(){return bn(this,wt(arguments))}}},ye={};Object.keys(de.preserve).forEach((t=>{ye[t]=de.preserve[t]})),Object.keys(de.vector).forEach((t=>{ye[t]=function(){return u.vector(...de.vector[t].apply(this,arguments))}}));const ve={fromAngle:function(t){return u.vector(Math.cos(t),Math.sin(t))},fromAngleDegrees:function(t){return u.vector.fromAngle(t*f)}};var Me={vector:{P:Array.prototype,A:function(){this.push(...wt(arguments))},G:{x:function(){return this[0]},y:function(){return this[1]},z:function(){return this[2]}},M:ye,S:ve}},xe={fromPoints:function(){const t=$t(arguments);return this.constructor({vector:H(t[1],t[0]),origin:t[0]})},fromAngle:function(){const t=arguments[0]||0;return this.constructor({vector:[Math.cos(t),Math.sin(t)],origin:[0,0]})},perpendicularBisector:function(){const t=$t(arguments);return this.constructor({vector:ot(H(t[1],t[0])),origin:K(t[0],t[1])})}};const be={isParallel:function(){const t=e(this.vector,Nt(arguments).vector);return at(...t)},isCollinear:function(){const t=Nt(arguments);return Zn(this.vector,this.origin,t.origin)&&at(...e(this.vector,t.vector))},isDegenerate:function(t=h){return ct(this.vector,t)},reflectionMatrix:function(){return u.matrix(jt(this.vector,this.origin))},nearestPoint:function(){const t=wt(arguments);return u.vector(Ht(this.vector,this.origin,t,this.clip_function))},transform:function(){const t=this.dimension,e=mt(Tt(arguments),n(3,this.vector),n(3,this.origin));return this.constructor(n(t,e.vector),n(t,e.origin))},translate:function(){const t=D(...e(this.origin,wt(arguments)));return this.constructor(this.vector,t)},intersect:function(){return ce(this,...arguments)},overlap:function(){return ge(this,...arguments)},bisect:function(t,n){const e=Nt(t);return An(this.vector,this.origin,e.vector,e.origin,n).map((t=>this.constructor(t)))}};var _e={line:{P:Object.prototype,A:function(){const t=Nt(...arguments);this.vector=u.vector(t.vector),this.origin=u.vector(n(this.vector.length,t.origin));const e=Bt({vector:this.vector,origin:this.origin});this.normal=e.normal,this.distance=e.distance,Object.defineProperty(this,"domain_function",{writable:!0,value:A})},G:{dimension:function(){return[this.vector,this.origin].map((t=>t.length)).reduce(((t,n)=>Math.max(t,n)),0)}},M:Object.assign({},be,{inclusive:function(){return this.domain_function=A,this},exclusive:function(){return this.domain_function=k,this},clip_function:t=>t,svgPath:function(t=2e4){const n=D(this.origin,F(this.vector,-t/2)),e=F(this.vector,t);return`M${n[0]} ${n[1]}l${e[0]} ${e[1]}`}}),S:Object.assign({fromNormalDistance:function(){return this.constructor(Ft(arguments[0]))}},xe)}},Pe={ray:{P:Object.prototype,A:function(){const t=Nt(...arguments);this.vector=u.vector(t.vector),this.origin=u.vector(n(this.vector.length,t.origin)),Object.defineProperty(this,"domain_function",{writable:!0,value:w})},G:{dimension:function(){return[this.vector,this.origin].map((t=>t.length)).reduce(((t,n)=>Math.max(t,n)),0)}},M:Object.assign({},be,{inclusive:function(){return this.domain_function=w,this},exclusive:function(){return this.domain_function=$,this},flip:function(){return u.ray(it(this.vector),this.origin)},scale:function(t){return u.ray(this.vector.scale(t),this.origin)},normalize:function(){return u.ray(this.vector.normalize(),this.origin)},clip_function:z,svgPath:function(t=1e4){const n=this.vector.scale(t);return`M${this.origin[0]} ${this.origin[1]}l${n[0]} ${n[1]}`}}),S:xe}},Oe={segment:{P:Array.prototype,A:function(){const t=St(...arguments);this.push(...[t[0],t[1]].map((t=>u.vector(t)))),this.vector=u.vector(H(this[1],this[0])),this.origin=this[0],Object.defineProperty(this,"domain_function",{writable:!0,value:S})},G:{points:function(){return this},magnitude:function(){return C(this.vector)},dimension:function(){return[this.vector,this.origin].map((t=>t.length)).reduce(((t,n)=>Math.max(t,n)),0)}},M:Object.assign({},be,{inclusive:function(){return this.domain_function=S,this},exclusive:function(){return this.domain_function=N,this},clip_function:I,transform:function(...t){const e=this.points[0].length,r=Tt(t),i=this.points.map((t=>n(3,t))).map((t=>pt(r,t))).map((t=>n(e,t)));return u.segment(i)},translate:function(){const t=wt(arguments),n=this.points.map((n=>D(...e(n,t))));return u.segment(n)},midpoint:function(){return u.vector(K(this.points[0],this.points[1]))},svgPath:function(){const t=this.points.map((t=>`${t[0]} ${t[1]}`));return["M","L"].map(((n,e)=>`${n}${t[e]}`)).join("")}}),S:{fromPoints:function(){return this.constructor(...arguments)}}}};const je=function(t,n,e,r,i,o){const s=Math.cos(i),c=Math.sin(i),a=Math.cos(o),u=Math.sin(o);return[t+s*e*a+-c*r*u,n+c*e*a+s*r*u]},Ae=function(t,n,e,r,i,o,s){let c=o;if(c<0&&!Number.isNaN(c))for(;c<0;)c+=2*Math.PI;const a=s>2*Math.PI?2*Math.PI:s,u=je(t,n,e,r,i,c),h=je(t,n,e,r,i,c+a/2),l=je(t,n,e,r,i,c+a),f=a/2>Math.PI?1:0,p=a/2>0?1:0;return{x1:u[0],y1:u[1],x2:h[0],y2:h[1],x3:l[0],y3:l[1],fa:f,fs:p}},ke=t=>i(t,4),we=(t,n,e,r,i,o,s)=>`A${ke(t)} ${ke(n)} ${ke(e)} ${ke(r)} ${ke(i)} ${ke(o)} ${ke(s)}`;var $e={circle:{A:function(){const t=Rt(...arguments);this.radius=t.radius,this.origin=u.vector(...t.origin)},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]},z:function(){return this.origin[2]}},M:{nearestPoint:function(){return u.vector(Xt(this.radius,this.origin,wt(arguments)))},intersect:function(t){return ce(this,t)},overlap:function(t){return ge(this,t)},svgPath:function(t=0,n=2*Math.PI){const e=Ae(this.origin[0],this.origin[1],this.radius,this.radius,0,t,n),r=we(this.radius,this.radius,0,e.fa,e.fs,e.x2,e.y2),i=we(this.radius,this.radius,0,e.fa,e.fs,e.x3,e.y3);return`M${e.x1} ${e.y1}${r}${i}`},points:function(t=128){return Array.from(Array(t)).map(((n,e)=>2*Math.PI/t*e)).map((t=>[this.origin[0]+this.radius*Math.cos(t),this.origin[1]+this.radius*Math.sin(t)]))},polygon:function(){return u.polygon(this.points(arguments[0]))},segments:function(){const t=this.points(arguments[0]);return t.map(((n,e)=>{const r=(e+1)%t.length;return[n,t[r]]}))}},S:{fromPoints:function(){if(3===arguments.length){const t=Gn(...arguments);return this.constructor(t.radius,t.origin)}return this.constructor(...arguments)},fromThreePoints:function(){const t=Gn(...arguments);return this.constructor(t.radius,t.origin)}}}};const Se=function(t,n,e,r){const i=n>e,o=i?n**2-e**2:e**2-n**2,s=Math.sqrt(o),c=i?Math.cos(r):Math.sin(r),a=i?Math.sin(r):Math.cos(r);return[u.vector(t[0]+s*c,t[1]+s*a),u.vector(t[0]-s*c,t[1]-s*a)]};var Ne={ellipse:{A:function(){const t=c(arguments).filter((t=>!Number.isNaN(t))),e=n(5,t);this.rx=e[0],this.ry=e[1],this.origin=u.vector(e[2],e[3]),this.spin=e[4],this.foci=Se(this.origin,this.rx,this.ry,this.spin)},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]}},M:{svgPath:function(t=0,n=2*Math.PI){const e=Ae(this.origin[0],this.origin[1],this.rx,this.ry,this.spin,t,n),r=we(this.rx,this.ry,this.spin/Math.PI*180,e.fa,e.fs,e.x2,e.y2),i=we(this.rx,this.ry,this.spin/Math.PI*180,e.fa,e.fs,e.x3,e.y3);return`M${e.x1} ${e.y1}${r}${i}`},points:function(t=128){return Array.from(Array(t)).map(((n,e)=>2*Math.PI/t*e)).map((t=>je(this.origin.x,this.origin.y,this.rx,this.ry,this.spin,t)))},polygon:function(){return u.polygon(this.points(arguments[0]))},segments:function(){const t=this.points(arguments[0]);return t.map(((n,e)=>{const r=(e+1)%t.length;return[n,t[r]]}))}},S:{}}};const ze={area:function(){return Bn(this)},centroid:function(){return u.vector(Fn(this))},boundingBox:function(){return Vn(this)},straightSkeleton:function(){return Xn(this)},scale:function(t,n=Fn(this)){const e=this.map((t=>[0,1].map(((e,r)=>t[r]-n[r])))).map((e=>e.map(((r,i)=>n[i]+e[i]*t))));return this.constructor.fromPoints(e)},rotate:function(t,n=Fn(this)){const e=this.map((e=>{const r=[e[0]-n[0],e[1]-n[1]],i=Math.sqrt(r[0]**2+r[1]**2),o=Math.atan2(r[1],r[0]);return[n[0]+Math.cos(o+t)*i,n[1]+Math.sin(o+t)*i]}));return u.polygon(e)},translate:function(){const t=wt(...arguments),n=this.map((n=>n.map(((n,e)=>n+t[e]))));return this.constructor.fromPoints(n)},transform:function(){const t=Tt(...arguments),e=this.map((e=>pt(t,n(3,e))));return u.polygon(e)},nearest:function(){const t=wt(...arguments),n=Ut(this,t);return void 0===n?void 0:Object.assign(n,{edge:this.sides[n.i]})},split:function(){const t=Nt(...arguments),n=Hn;return n(this,t.vector,t.origin).map((t=>u.polygon(t)))},overlap:function(){return ge(this,...arguments)},intersect:function(){return ce(this,...arguments)},clip:function(t,n){const e=t.domain_function?t.domain_function:A,r=gn(this,t.vector,t.origin,this.domain_function,e,n);return r?u.segment(r):void 0},svgPath:function(){const t=Array(this.length).fill("L");return t[0]="M",`${this.map(((n,e)=>`${t[e]}${n[0]} ${n[1]}`)).join("")}z`}},Ie=t=>[[t.x,t.y],[t.x+t.width,t.y],[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]];var Le={rect:{P:Array.prototype,A:function(){const t=Lt(...arguments);this.width=t.width,this.height=t.height,this.origin=u.vector(t.x,t.y),this.push(...Ie(this)),Object.defineProperty(this,"domain_function",{writable:!0,value:O})},G:{x:function(){return this.origin[0]},y:function(){return this.origin[1]},center:function(){return u.vector(this.origin[0]+this.width/2,this.origin[1]+this.height/2)}},M:Object.assign({},ze,{inclusive:function(){return this.domain_function=O,this},exclusive:function(){return this.domain_function=j,this},area:function(){return this.width*this.height},segments:function(){return[[[(t=this).x,t.y],[t.x+t.width,t.y]],[[t.x+t.width,t.y],[t.x+t.width,t.y+t.height]],[[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]],[[t.x,t.y+t.height],[t.x,t.y]]];var t},svgPath:function(){return`M${this.origin.join(" ")}h${this.width}v${this.height}h${-this.width}Z`}}),S:{fromPoints:function(){const t=Vn($t(arguments));return u.rect(t.min[0],t.min[1],t.span[0],t.span[1])}}}},Ce={polygon:{P:Array.prototype,A:function(){this.push(...s(arguments)),this.sides=this.map(((t,n,e)=>[t,e[(n+1)%e.length]])),this.vectors=this.sides.map((t=>H(t[1],t[0]))),Object.defineProperty(this,"domain_function",{writable:!0,value:O})},G:{isConvex:function(){},points:function(){return this}},M:Object.assign({},ze,{inclusive:function(){return this.domain_function=O,this},exclusive:function(){return this.domain_function=j,this},segments:function(){return this.sides}}),S:{fromPoints:function(){return this.constructor(...arguments)},regularPolygon:function(){return this.constructor(qn(...arguments))},convexHull:function(){return this.constructor(zn(...arguments))}}}},Re={polyline:{P:Array.prototype,A:function(){this.push(...s(arguments))},G:{points:function(){return this}},M:{svgPath:function(){const t=Array(this.length).fill("L");return t[0]="M",`${this.map(((n,e)=>`${t[e]}${n[0]} ${n[1]}`)).join("")}`}},S:{fromPoints:function(){return this.constructor(...arguments)}}}};const Ee=(t,n)=>{for(let e=0;e<12;e+=1)t[e]=n[e];return t};var qe={matrix:{P:Array.prototype,A:function(){Tt(arguments).forEach((t=>this.push(t)))},G:{},M:{copy:function(){return u.matrix(...Array.from(this))},set:function(){return Ee(this,Tt(arguments))},isIdentity:function(){return ft(this)},multiply:function(t){return Ee(this,gt(this,t))},determinant:function(){return dt(this)},inverse:function(){return Ee(this,yt(this))},translate:function(t,n,e){return Ee(this,gt(this,vt(t,n,e)))},rotateX:function(t){return Ee(this,gt(this,xt(t)))},rotateY:function(t){return Ee(this,gt(this,bt(t)))},rotateZ:function(t){return Ee(this,gt(this,_t(t)))},rotate:function(t,n,e){const r=Pt(t,n,e);return Ee(this,gt(this,r))},scale:function(...t){return Ee(this,gt(this,Ot(...t)))},reflectZ:function(t,n){const e=jt(t,n);return Ee(this,gt(this,e))},transform:function(...t){return u.vector(pt(this,n(3,wt(t))))},transformVector:function(t){return u.vector(pt(this,n(3,wt(t))))},transformLine:function(...t){const n=Nt(t);return u.line(mt(this,n.vector,n.origin))}},S:{}}};const Te=Object.assign({},Me,_e,Pe,Oe,$e,Ne,Le,Ce,Re,qe),Ge=function(t,n){const e=Object.create(Te[t].proto);return Te[t].A.apply(e,n),e};Object.assign(u,{vector:function(){return Ge("vector",arguments)},line:function(){return Ge("line",arguments)},ray:function(){return Ge("ray",arguments)},segment:function(){return Ge("segment",arguments)},circle:function(){return Ge("circle",arguments)},ellipse:function(){return Ge("ellipse",arguments)},rect:function(){return Ge("rect",arguments)},polygon:function(){return Ge("polygon",arguments)},polyline:function(){return Ge("polyline",arguments)},matrix:function(){return Ge("matrix",arguments)}}),Object.keys(Te).forEach((t=>{const n={};n.prototype=null!=Te[t].P?Object.create(Te[t].P):Object.create(Object.prototype),n.prototype.constructor=n,u[t].prototype=n.prototype,u[t].prototype.constructor=u[t],Object.keys(Te[t].G).forEach((e=>Object.defineProperty(n.prototype,e,{get:Te[t].G[e]}))),Object.keys(Te[t].M).forEach((e=>Object.defineProperty(n.prototype,e,{value:Te[t].M[e]}))),Object.keys(Te[t].S).forEach((n=>Object.defineProperty(u[t],n,{value:Te[t].S[n].bind(u[t].prototype)}))),Te[t].proto=n.prototype}));const Be=u;return Be.core=Object.assign(Object.create(null),m,a,Gt,L,ut,Kt,Sn,In,Cn,Dn,Sn,rn,At,ln,Yt,Vt,Yn,Wn,{intersectConvexPolygonLine:ee,intersectCircleCircle:Kn,intersectCircleLine:Qn,intersectLineLine:Ln,overlapConvexPolygons:ae,overlapConvexPolygonPoint:fn,overlapBoundingBoxes:(t,n)=>{const e=Math.min(t.min.length,n.min.length);for(let r=0;r<e;r+=1)if(t.min[r]>n.max[r]||t.max[r]<n.min[r])return!1;return!0},overlapLineLine:he,overlapLinePoint:Zn,clipLineConvexPolygon:gn,clipPolygonPolygon:(t,n,e=h)=>{let r,i,o,s;const c=t=>(i[0]-r[0])*(t[1]-r[1])>(i[1]-r[1])*(t[0]-r[0])+e,a=()=>{const t=[r[0]-i[0],r[1]-i[1]],n=[o[0]-s[0],o[1]-s[1]],e=r[0]*i[1]-r[1]*i[0],c=o[0]*s[1]-o[1]*s[0],a=1/(t[0]*n[1]-t[1]*n[0]);return[(e*n[0]-c*t[0])*a,(e*n[1]-c*t[1])*a]};let u=t;r=n[n.length-1];for(let t in n){i=n[t];const e=u;u=[],o=e[e.length-1];for(let t in e)s=e[t],c(s)?(c(o)||u.push(a()),u.push(s)):c(o)&&u.push(a()),o=s;r=i}return 0===u.length?void 0:u},splitConvexPolygon:Hn,straightSkeleton:Xn}),Be.typeof=t,Be.intersect=ce,Be.overlap=ge,Be}));
